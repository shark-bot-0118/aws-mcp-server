# =============================================================================
# AWS Tool-Execution MCP Server - Configuration
# =============================================================================
# Copy this file to .env and customize as needed.
# See DESIGN.md for detailed documentation.

# =============================================================================
# Transport Mode
# =============================================================================
# stdio  - Local MCP server for desktop clients (default)
# http   - HTTP server with JWT authentication
# remote - HTTP server with Streamable HTTP transport
TRANSPORT_MODE=stdio

# =============================================================================
# Server Settings
# =============================================================================
MCP_HOST=0.0.0.0
MCP_PORT=8000
LOG_LEVEL=INFO
# LOG_FILE=aws_cli_mcp.log

# Custom instructions for the MCP server
# MCP_INSTRUCTIONS=Use these tools to plan, diff, and apply AWS operations.

# =============================================================================
# Authentication Provider (HTTP/Remote modes)
# =============================================================================
# multi-idp       - OAuth 2.0 Protected Resource with multiple IdPs (recommended)
# identity-center - AWS IAM Identity Center
AUTH_PROVIDER=multi-idp

# --- Multi-IdP Mode (AUTH_PROVIDER=multi-idp) ---
# Path to IdP configuration file (required for multi-idp mode)
# AUTH_IDP_CONFIG_PATH=./idp_config.yaml

# --- Identity Center Mode (AUTH_PROVIDER=identity-center) ---
# Region where IAM Identity Center is configured
# AUTH_IDENTITY_CENTER_REGION=us-east-1

# --- IdP-specific Variables (used in idp_config.yaml) ---
# Microsoft Entra ID (Azure AD)
# ENTRA_TENANT_ID=your-tenant-id-here
# ENTRA_CLIENT_ID=your-client-id-here
# ENTRA_PROXY_CLIENT_ID=your-upstream-entra-client-id
# ENTRA_PROXY_CLIENT_SECRET=your-upstream-entra-client-secret

# Auth0 (if using Auth0 IdP)
# AUTH0_DOMAIN=your-tenant.auth0.com

# =============================================================================
# Security Settings (HTTP/Remote modes)
# =============================================================================
# Rate limiting
AUTH_RATE_LIMIT_PER_USER=100
AUTH_RATE_LIMIT_PER_IP=1000

# Request size limits
AUTH_MAX_BODY_SIZE_MB=10
AUTH_MAX_HEADER_SIZE_KB=8

# Timeouts
AUTH_REQUEST_TIMEOUT_SECONDS=30

# Credential caching
AUTH_CREDENTIAL_REFRESH_BUFFER_SECONDS=300
AUTH_CREDENTIAL_CACHE_MAX_ENTRIES=1000
# Allow multiple authenticated principals in one server process
AUTH_ALLOW_MULTI_USER=false

# =============================================================================
# Streamable HTTP Settings (Remote mode)
# =============================================================================
# Comma-separated list of allowed origins (empty = allow all)
HTTP_ALLOWED_ORIGINS=
# Allow requests without Origin header
HTTP_ALLOW_MISSING_ORIGIN=true
# Enable CORS middleware for browser clients
HTTP_ENABLE_CORS=false
# Trust X-Forwarded-* headers from a trusted reverse proxy only
HTTP_TRUST_FORWARDED_HEADERS=false

# =============================================================================
# AWS Settings
# =============================================================================
# Default region for AWS operations
AWS_REGION=us-east-1

# --- Stdio Mode ---
# Use an existing profile from ~/.aws/credentials
# Handles SSO, MFA, and access keys automatically
AWS_PROFILE=default

# --- HTTP/Remote Mode ---
# STS region for AssumeRoleWithWebIdentity
AWS_STS_REGION=us-east-1

# --- Manual Credentials (CI/Docker) ---
# Only use these if NOT using a profile
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_SESSION_TOKEN=  # Required only for temporary credentials (ASIA...)

# =============================================================================
# Safety & Policy
# =============================================================================
# Path to policy.yaml for allow/deny rules
POLICY_PATH=./policy.yaml

# Skip confirmation prompts for destructive operations (NOT recommended for production)
AWS_MCP_AUTO_APPROVE_DESTRUCTIVE=false

# Require explicit approval for all operations
MCP_REQUIRE_APPROVAL=false

# =============================================================================
# Storage
# =============================================================================
# Audit database
SQLITE_PATH=./data/aws_mcp.sqlite
SQLITE_WAL=true

# Artifact storage for request/response payloads
ARTIFACT_PATH=./data/artifacts

# =============================================================================
# Smithy Models
# =============================================================================
# Auto-sync AWS API models from GitHub
SMITHY_AUTO_SYNC=false
SMITHY_SYNC_URL=https://github.com/aws/api-models-aws.git
SMITHY_SYNC_REF=main
SMITHY_CACHE_PATH=./data/smithy_cache
SMITHY_MODEL_PATH=./data/smithy_cache/models

# Number of model versions to cache in memory
SMITHY_MODEL_CACHE_SIZE=3

# =============================================================================
# Performance
# =============================================================================
# SDK timeout for AWS API calls
SDK_TIMEOUT_SECONDS=30

# Maximum characters in tool output
MAX_OUTPUT_CHARACTERS=20000

# Retry count for transient failures
AWS_MCP_MAX_RETRIES=2
